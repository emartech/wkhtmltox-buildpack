#!/usr/bin/env bash

set -e

BIN_PATH="$1/bin/"
mkdir -p $BIN_PATH

WKHTML_TO_X_INSTALLER       = "http://sourceforge.net/projects/wkhtmltopdf/files/0.12.1/wkhtmltox-0.12.1_linux-trusty-amd64.deb/download"
WKHTML_TO_PDF_FILE          = "$1/bin/wkhtmltopdf"
WKHTML_TO_IMAGE_FILE        = "$1/bin/wkhtmltoimage"
WKHTML_TO_X_COMPRESSED_PATH = "$1/bin/wkhtmltox.tar.xz"
WKHTML_TO_X_PATH            = "$1/bin/wkhtmltox"

echo "-----> Downloading wkhtmltox compressed binary"
curl -L $WKHTML_TO_X_INSTALLER -o $WKHTML_TO_X_COMPRESSED_PATH

echo "-----> Decompressing binary"
tar xJf $WKHTML_TO_X_COMPRESSED_PATH --directory $BIN_PATH

echo "-----> Removing compressed binary"
rm -f $WKHTML_TO_X_COMPRESSED_PATH

echo "-----> Moving binary to the right place from wkhtmltox"
mv $WKHTML_TO_X_PATH/bin/wkhtmltopdf $BIN_PATH
mv $WKHTML_TO_X_PATH/bin/wkhtmltoimage $BIN_PATH

echo "-----> Removing wkhtmltox folder"
rm -rf $WKHTML_TO_X_PATH

echo "-----> Setting permissions"
chmod +x $WKHTML_TO_PDF_FILE
chmod +x $WKHTML_TO_IMAGE_FILE

exit 0
